<!DOCTYPE html>
<html>
<head>
    <title>Spectrum Customizer</title>
    <style>
         body {
           font-family: Arial, Helvetica, sans-serif;
           background-color: #eee;
         }
        </style>
    <meta name="viewport" content="width=device-width, initial-scale=1" >
</head>
<body>
<div id="spectrum-customizer"></div>
<script>
          window.customizerWrapperId = 'spectrum-customizer';
</script>

<script>

         window.customizerWrapperId = 'spectrum-customizer';

         window.pendingPriceUpdates = {};

         window.integration = window.integration || {};

         window.integration.loadRecipe = function (recipeData) {
           console.log(recipeData);
           var data = typeof recipeData === "string" ? JSON.parse(recipeData) : recipeData;
           window.spectrum.fromCustomizer.switchRecipeSet(data.recipeSetReadableId)
         };

         window.integration.loadSku = function (sku) {
           console.log(sku);
           var data = typeof sku === "string" ? JSON.parse(sku) : sku;
           window.spectrum.fromCustomizer.goToProduct(data.productId)
         };

         window.integration.addToCart = function(skus, recipeSetId, options) {

           let cartData = {
             skus: skus,
             recipeSetId: recipeSetId,
             options: options
           };

           if (typeof window.SpectrumNative !== 'undefined') {
             window.SpectrumNative.addToCart(JSON.stringify(cartData));
           } else if (window.webkit && typeof window.webkit.messageHandlers.addToCart !== 'undefined') {
             window.webkit.messageHandlers.addToCart.postMessage(cartData);
           }
         }

         window.integration.spectrumGetPriceAndInventory = function (skus, options) {

           return new Promise((resolve, reject) => {

             const callbackId = generateId();

             window.pendingPriceUpdates[callbackId] = {
               resolve: resolve,
               reject: reject
             };

             const priceData = {
               callbackId: callbackId,
               skus: skus,
               options: options
             };

             if (typeof window.SpectrumNative !== 'undefined') {
               window.SpectrumNative.getPrice(JSON.stringify(priceData));
             } else if (window.webkit && typeof window.webkit.messageHandlers.addToCart !== 'undefined') {
               window.webkit.messageHandlers.getPrice.postMessage(priceData);
             } else {
               reject();
             }
           });
         }

         function resolvePrice(callbackId, prices) {
           if (window.pendingPriceUpdates.hasOwnProperty(callbackId)) {
             window.pendingPriceUpdates[callbackId].resolve(prices);
           }
         }

         function generateId() {
           return parseInt(Math.random() * 10000000);
         }

         window.loadCustomizer = function (script) {
           let elem = document.createElement('script');
           elem.src = script;
           document.getElementsByTagName('body')[0].append(elem);
         }

        </script>
</body>
</html>
